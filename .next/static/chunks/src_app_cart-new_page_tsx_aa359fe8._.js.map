{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/app/cart-new/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useSession } from \"next-auth/react\";\n\ninterface CartItem {\n  id: string;\n  quantity: number;\n  size: string;\n  product: {\n    id: string;\n    name: string;\n    price: number;\n    image: string;\n  };\n}\n\ninterface Cart {\n  id: string;\n  items: CartItem[];\n}\n\nexport default function CartPage() {\n  const [cart, setCart] = useState<Cart | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const { data: session } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (!session) {\n      router.push(\"/auth/login\");\n      return;\n    }\n\n    fetchCart();\n  }, [session, router]);\n\n  const fetchCart = async () => {\n    try {\n      const response = await fetch(\"/api/cart-new\");\n      if (!response.ok) throw new Error(\"Failed to fetch cart\");\n      const data = await response.json();\n      setCart(data);\n    } catch (err) {\n      setError(\"Ошибка при загрузке корзины\");\n      console.error(err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const removeFromCart = async (itemId: string) => {\n    try {\n      const response = await fetch(`/api/cart-new?itemId=${itemId}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to remove item\");\n      await fetchCart();\n    } catch (err) {\n      setError(\"Ошибка при удалении товара\");\n      console.error(err);\n    }\n  };\n\n  const handleCheckout = async () => {\n    try {\n      const response = await fetch(\"/api/checkout\", {\n        method: \"POST\",\n      });\n      \n      if (!response.ok) throw new Error(\"Checkout failed\");\n      \n      const { url } = await response.json();\n      window.location.href = url;\n    } catch (err) {\n      setError(\"Ошибка при оформлении заказа\");\n      console.error(err);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-black\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-red-500 mb-4\">{error}</p>\n          <button\n            onClick={fetchCart}\n            className=\"bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition-colors\"\n          >\n            Попробовать снова\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!cart || cart.items.length === 0) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Корзина пуста</h1>\n          <p className=\"text-gray-600 mb-8\">\n            Добавьте товары в корзину, чтобы оформить заказ\n          </p>\n          <Link\n            href=\"/catalog\"\n            className=\"bg-black text-white px-6 py-3 rounded-md hover:bg-gray-800 transition-colors\"\n          >\n            Перейти в каталог\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const total = cart.items.reduce(\n    (sum, item) => sum + item.product.price * item.quantity,\n    0\n  );\n\n  return (\n    <div className=\"max-w-6xl mx-auto px-4 py-8\">\n      <h1 className=\"text-2xl font-bold mb-8\">Корзина</h1>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        <div className=\"lg:col-span-2 space-y-4\">\n          {cart.items.map((item) => (\n            <div\n              key={item.id}\n              className=\"flex items-start space-x-4 bg-white p-4 rounded-lg shadow-sm\"\n            >\n              <div className=\"relative w-24 h-24 flex-shrink-0\">\n                <Image\n                  src={item.product.image}\n                  alt={item.product.name}\n                  fill\n                  sizes=\"96px\"\n                  className=\"object-cover rounded\"\n                />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-medium\">{item.product.name}</h3>\n                <p className=\"text-gray-600\">Размер: {item.size}</p>\n                <p className=\"text-gray-600\">\n                  Количество: {item.quantity} шт.\n                </p>\n                <p className=\"font-medium\">\n                  {(item.product.price * item.quantity).toLocaleString(\"ru-RU\", {\n                    style: \"currency\",\n                    currency: \"RUB\",\n                  })}\n                </p>\n              </div>\n              <button\n                onClick={() => removeFromCart(item.id)}\n                className=\"text-red-500 hover:text-red-600 transition-colors\"\n              >\n                <svg\n                  className=\"w-5 h-5\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n                  />\n                </svg>\n              </button>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"bg-white p-6 rounded-lg shadow-sm h-fit\">\n          <h2 className=\"text-xl font-bold mb-4\">Итого</h2>\n          <div className=\"space-y-2 mb-6\">\n            <div className=\"flex justify-between\">\n              <span>Товары ({cart.items.length})</span>\n              <span>\n                {total.toLocaleString(\"ru-RU\", {\n                  style: \"currency\",\n                  currency: \"RUB\",\n                })}\n              </span>\n            </div>\n            <div className=\"flex justify-between font-bold text-lg border-t pt-2\">\n              <span>К оплате</span>\n              <span>\n                {total.toLocaleString(\"ru-RU\", {\n                  style: \"currency\",\n                  currency: \"RUB\",\n                })}\n              </span>\n            </div>\n          </div>\n          <button\n            onClick={handleCheckout}\n            className=\"w-full bg-black text-white py-3 rounded-md hover:bg-gray-800 transition-colors\"\n          >\n            Оформить заказ\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}